@model BookStore.Models.Orders

@{
    IEnumerable<OrderDetail> OrderDetails = ViewBag.orderDetails as List<OrderDetail>;
}


<link href="~/Admin/css/ProductImage.css" rel="stylesheet" />
<div class="row">
    <div class="col-md-12">
        <div class="box">
            <div class="box-title">
                <h3><i class="fa fa-plus"></i>Edit Order</h3>
                <div class="box-tool">
                    <a data-action="collapse" href="#"><i class="fa fa-chevron-up"></i></a>
                    <a data-action="close" href="#"><i class="fa fa-times"></i></a>
                </div>
            </div>
            <div class="box-content">
                <div class="table-responsive" style="border:0">
                    <form asp-action="Edit" method="post" id="formAdd" enctype="multipart/form-data">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        <input type="hidden" asp-for="OrderId" />
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="form-group">
                                    <h5>Mã Khách hàng</h5>
                                    <input asp-for="EmployeeId" class="form-control" readonly />
                                    <span asp-validation-for="EmployeeId" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <h5>Tên Khách hàng</h5>
                                    <input asp-for="Name" class="form-control" />
                                    <span asp-validation-for="Name" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <h5>Tên nhân viên</h5>
                                    <select asp-for="EmployeeId" class="form-control" asp-items="ViewBag.EmployeeId"></select>
                                    <span asp-validation-for="EmployeeId" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <h5>Địa chỉ</h5>
                                    <input asp-for="Address" class="form-control inputUrl" />
                                    <span asp-validation-for="Address" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <h5>Phương thức thanh toán</h5>
                                    <input asp-for="PayMethod" class="form-control" />
                                    <span asp-validation-for="PayMethod" class="text-danger"></span>
                                </div>

                            </div>
                            <div class="col-lg-6">
                                <div class="form-group">
                                    <h5>Phương thức giao hàng</h5>
                                    <input asp-for="ShipMethod" class="form-control" />
                                    <span asp-validation-for="ShipMethod" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <h5>Trạng thái đơn hàng</h5>
                                    <input asp-for="OrderStatus" class="form-control" />
                                    <span asp-validation-for="OrderStatus" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <h5>Phí Ship</h5>
                                    <input asp-for="ShipCost" class="form-control" />
                                    <span asp-validation-for="ShipCost" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <h5>Ghi chú</h5>
                                    <input asp-for="Comment" class="form-control inputPrice" />
                                    <span asp-validation-for="Comment" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <h5>Ngày giao hàng dự kiến:</h5>
                                    <input asp-for="ShipDate" class="form-control" />
                                    <span asp-validation-for="ShipDate" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="page-header text-center">
                                <h3>Danh sách sản phẩm đã chọn <small></small></h3>
                            </div>
                            <div class="container">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Tên sản phẩm</th>
                                            <th scope="col">Mã sản phẩm</th>
                                            <th scope="col">Số lượng</th>
                                            <th scope="col">Tùy chọn</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @{ var count = 1;}
                                        @foreach (var item in OrderDetails)
                                        {
                                            <tr class="row-@item.ProductId">
                                                <th scope="row">@(count++)</th>
                                                <td>@item.Product.ProductName</td>
                                                <td>@item.ProductId</td>
                                                <td>
                                                    <input type="number" class="form-control quantity-product" value="@item.Quantity" />
                                                    <input type="hidden" value="@item.ProductId" />
                                                </td>
                                                <td>
                                                    <span class="glyphicon glyphicon-remove" onclick="removeMe(@item.ProductId)" aria-hidden="true"></span>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="form-group">
                            <br />
                            <button class="btn btn-primary"><i class="fa fa-save"></i> Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- The Close Button -->
    <span class="close">&times;</span>

    <!-- Modal Content (The Image) -->
    <img class="modal-content" id="img01">

    <!-- Modal Caption (Image Text) -->
    <div id="caption"></div>
</div>
<script src="https://cdn.ckeditor.com/ckeditor5/15.0.0/classic/ckeditor.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>

    $("#OrderStatus").mouseenter(function () {
        var val = `1 - Đã thanh toán
                   0 - Chưa thanh toán`;
        $(this).attr('title', val);
    });

    $(".quantity-product").change(function () {
        let quantity = $(this).val();
        let productId = $(this).next().val();
        $.ajax({
            url: "/Admin/Orders/EditQuantityOrderDetail",
            type: "POST",
            data: {
                orderId: @Model.OrderId,
                productId: productId,
                quantity: quantity
            },
            success: function (data) {
            }
        })
    })

    function removeMe(id) {
        alert(id);

        $.ajax({
            url: "/Admin/Orders/DeleteOrderDetail",
            type: "DELETE",
            data: {
                orderId: @Model.OrderId,
                productId: id,
            },
            success: function (data) {
                $(".row-" + id).remove();
            }
        })
    }
</script>